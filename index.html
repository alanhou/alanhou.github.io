<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"alanhou.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.14.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Alan Hou的个人博客">
<meta property="og:url" content="https://alanhou.github.io/index.html">
<meta property="og:site_name" content="Alan Hou的个人博客">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Alan Hou">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://alanhou.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Alan Hou的个人博客</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Alan Hou的个人博客</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">用行动赢得尊重</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Alan Hou</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">2</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://alanhou.github.io/2019/01/04/odoo-essentials-12-chapter2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Alan Hou">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Alan Hou的个人博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Alan Hou的个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/01/04/odoo-essentials-12-chapter2/" class="post-title-link" itemprop="url">第二章 Odoo 12开发之开发环境准备</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-01-04 00:00:00" itemprop="dateCreated datePublished" datetime="2019-01-04T00:00:00+08:00">2019-01-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-02-03 13:32:03" itemprop="dateModified" datetime="2023-02-03T13:32:03+08:00">2023-02-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>本文为<a target="_blank" rel="noopener" href="https://alanhou.org/developer-mode-odoo12">最好用的免费ERP系统Odoo 12开发手册</a>系列文章第一篇。</p>
<p>本文为<a target="_blank" rel="noopener" href="https://alanhou.org/odoo-12-development/">最好用的免费ERP系统Odoo 12开发手册</a>系列文章第二篇。</p>
<p>在更深入了解 Odoo 开发之前，我们应配置好开发环境并学习相关的基础管理任务。本文中，我们将学习创建 Odoo 应用所需用到的工具和环境配置。这里采用 Ubuntu 系统来作为开发服务器实例的主机，可以是云服务器、本地服务器或者PC 上的虚拟机。</p>
<p>本文主要内容有：</p>
<ul>
<li>配置主机，可以是 Ubuntu系统或 PC 机上的 Linux 子系统</li>
<li>使用源码安装 Odoo，包括数据库和系统依赖的安装</li>
<li>管理 Odoo 数据库（创建、删除和拷贝）</li>
<li>配置 Odoo 服务器选项</li>
<li>查找并安装社区插件</li>
<li>使用虚拟环境管理 Odoo 不同版本和项目</li>
<li>开启服务端开发者模式简化开发任务</li>
</ul>
<h2 id="开发准备"><a href="#开发准备" class="headerlink" title="开发准备"></a>开发准备</h2><p>本文将介绍如何在开发电脑上使用源码安装 Odoo，建议使用系统是Ubuntu 18.04 ，也可以选择 Windows 10，文中会介绍到如何在 Windows 下安装 Linux 子系统。相关代码可参见 <a target="_blank" rel="noopener" href="https://github.com/alanhou/odoo12-development">GitHub 仓库</a>。</p>
<h2 id="设置-Odoo-服务宿主机"><a href="#设置-Odoo-服务宿主机" class="headerlink" title="设置 Odoo 服务宿主机"></a>设置 Odoo 服务宿主机</h2><p>推荐使用Debian&#x2F;Ubuntu来运行 Odoo 服务。虽然 Odoo 是一个跨平台的系统，可以运行在不同的操作系统上，但事实上 Odoo 的研发(R&amp;D)团队把 Debian 系作为参照部署平台。并且 Odoo 自己的 SaaS 平台也运行在 Debian 之上。这也是社区中最主流的选择，说明使用Debian 或 Ubuntu 会更容易寻求到帮助和建议。你也许仅有 Windows 相关背景，但对Debian 系有一定了解也非常重要。</p>
<p>当然你依然可以选择自己喜欢的系统，如 Windows, Mac 或其它Linux发行版本（如 CentOS）。</p>
<blockquote>
<p>ℹ️本文中介绍的是在一个全新的系统中进行开发，如果你在已有系统中开发，请做好备份以在出错时进行恢复</p>
</blockquote>
<h3 id="使用-Windows-子系统安装-Linux"><a href="#使用-Windows-子系统安装-Linux" class="headerlink" title="使用 Windows 子系统安装 Linux"></a>使用 Windows 子系统安装 Linux</h3><p>在 Windows 系统中，最简单的方案是使用 Windows 10自带的Linux子系统(WSL - Windows Subsystem for Linux)。通过子系统，我们可以在 Windows 内运行 Ubuntu 系统，足以应对 Odoo 开发所需的一切。更多 WSL 相关知识请参考<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/wsl/about">官网</a>。</p>
<p>WSL 是Windows 10最近发布中的一个可选功能，使用前需要先启用。启用后即可在商店中安装 Ubuntu，详见<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">官方帮助文档</a>。</p>
<p>在写本文时，需要如下步骤来完成安装：</p>
<p>第一步是要确保 WSL 功能已开启，以管理员身份打开 PowerShell 并运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux</span><br></pre></td></tr></table></figure>

<p>以上命令需要在单行执行，然后根据提示重启电脑。然后我们就可以安装Ubuntu Windows应用，最简单地方式是在自带微软商店中搜索 Ubuntu，在写本文时最新的长期支持版本（LTS）是18.04，按照提示进行安装即可。运行 Ubuntu 应用会打开一个bash 命令行，这里可以输入在 Ubuntu 系统中相同的命令。需要记住在安装时配置的用户名和密码，因为在进行提权操作时会要求输入该信息(如运行 sudo 时)。</p>
<h3 id="安装-Linux-服务器"><a href="#安装-Linux-服务器" class="headerlink" title="安装 Linux 服务器"></a>安装 Linux 服务器</h3><p>我们还可以选择在电脑上安装 Linux，或在局域网乃至云端安装 Linux 系统。我们需要一台基于 Debian 的服务器用于 Odoo 服务端开发，如果此前你没有接触过 Linux, 请注意 Ubuntu 是一个基于 Debian 的 Linux 发行版本，所以两者极为相似。Odoo 保证可在当前稳定的 Debian 或 Ubuntu 版本上运行，在写本文时，分别为 Debian 9（Stretch）和Ubuntu 18.04 LTS（Bionic Beaver）。</p>
<p>更推荐选择 Ubuntu，因安装上较 Debian 容易。可从 <a target="_blank" rel="noopener" href="https://www.ubuntu.com/">Ubuntu 官网</a>上下载 ISO 镜像，建议使用最新的 LTS 版本。如果你刚刚接触 Linux，使用预配置的镜像会更容易些。TurnKey Linux提供了含 ISO 的多种格式预安装镜像。ISO 格式可以在任意虚拟化软件上使用，即便是裸机。较优的选择是 <a target="_blank" rel="noopener" href="https://www.turnkeylinux.org/lapp">LAPP 镜像</a>，已安装了 Odoo 所需的Python 和 PostgreSQL。</p>
<p>为能够进行远程操作，通常需安装OpenSSH服务。在 Ubuntu 的设置助手中有这一服务，但也可以通过如下命令来进行安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openssh-server</span><br></pre></td></tr></table></figure>

<p>然后需要使用 SSH（Secure Shell）客户端来连接 Odoo 的宿主机，Windows 中常用的有 <a target="_blank" rel="noopener" href="https://www.putty.org/">PuTTY</a>、<a target="_blank" rel="noopener" href="https://xshell.en.softonic.com/">XShell</a> 和 <a target="_blank" rel="noopener" href="https://www.vandyke.com/products/securecrt/">SecureCRT</a>。</p>
<p>可以通过如下命令来查看服务器的 IP 地址：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip addr show</span><br></pre></td></tr></table></figure>

<p>使用 SSH 客户端可以远程操作 Linux 主机，还可以获得比在虚拟机终端操作更好的体验，我们可以更容易的复制粘贴、修改窗口大小、字体等。</p>
<p><strong>补充：</strong> 关于虚拟机 Hyper-V,  VMware, VirtualBox和 Vagrant 都是很好的方案，网上有很多资料，限于篇幅本文不再介绍。</p>
<h2 id="源码安装-Odoo"><a href="#源码安装-Odoo" class="headerlink" title="源码安装 Odoo"></a>源码安装 Odoo</h2><p>在本系列文件第一篇<a target="_blank" rel="noopener" href="https://alanhou.org/developer-mode-odoo12/">使用开发者模式快速入门 Odoo 12</a>中，我们介绍了快速运行 Odoo 的各种方式，本文中我们将更深入一步，直接通过源码来安装、运行 Odoo。</p>
<p>Odoo使用Python 编程语言，数据存储使用 PostgreSQL数据库，这是对 Odoo 主机的两大要求。要使用源码运行 Odoo，首先要安装其所依赖的 Python 库。然后从 GitHub 上下载源代码，虽然可以下载 zip 和 tar 文件，但使用 Git版本管理工具获取代码会更优。</p>
<blockquote>
<p>ℹ️具体依赖的安装根据操作系统和安装的 Odoo 版本可能会不同。如果在上述步骤中存在问题，请参考<a target="_blank" rel="noopener" href="https://www.odoo.com/documentation/12.0/setup/install.html">官方文档</a>，可切换版本查看其它版本的操作步骤。</p>
</blockquote>
<h3 id="安装-PostgreSQL-数据库"><a href="#安装-PostgreSQL-数据库" class="headerlink" title="安装 PostgreSQL 数据库"></a>安装 PostgreSQL 数据库</h3><p>Odoo 要使用到 PostgreSQL服务，典型的开发设置是使用安装 Odoo 的同一台机器安装PostgreSQL。下面我们就来安装数据库服务：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install postgresql -y # 安装PostgreSQL</span><br><span class="line">sudo su -c &quot;createuser -s $USER&quot; postgres # 创建数据库超级用户</span><br></pre></td></tr></table></figure>

<p>最后这条命令为当前系统用户创建了一个PostgreSQL用户，用于 Odoo 实例创建或删除数据库时使用。</p>
<p>如果在 WSL内运行 Ubuntu，注意系统服务不会自动启动。也就是说运行任何需要数据库连接的命令（如createuser或启动 Odoo 服务）时都要手动开启PostgreSQL服务，手动启动PostgreSQL服务执行：sudo service postgresql start。</p>
<h3 id="安装-Odoo-系统依赖"><a href="#安装-Odoo-系统依赖" class="headerlink" title="安装 Odoo 系统依赖"></a>安装 Odoo 系统依赖</h3><p>要运行 Odoo，我们还需要一些系统包和软件。获取版本控制的源码应安装 Git，安装运行 Odoo要求 Python 3.5或之后的版本、Python 3的 pip 以及一些 Python 包的系统依赖：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt upgrade</span><br><span class="line">sudo apt install git -y # 安装Git</span><br><span class="line">sudo apt install python3-dev python3-pip -y # Python 3 for dev</span><br><span class="line">sudo apt install build-essential libxslt-dev libzip-dev libldap2-dev libsasl2-dev libssl-dev -y</span><br></pre></td></tr></table></figure>

<p>Odoo 9, 10, and 11版要用到less CSS 预处理器，所以对这些版本需要执行如下安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install npm # 安装Node.js和包管理器</span><br><span class="line">sudo ln -s /usr/bin/nodejs /usr/bin/node # 通过node运行Node.js</span><br><span class="line">sudo npm install -g less less-plugin-clean-css # 安装less</span><br></pre></td></tr></table></figure>

<p>Odoo 12中无需执行如上命令，但通常我们也会用到前述版本，如果有此情况则仍需安装。</p>
<blockquote>
<p><strong>ℹ️Odoo 12中的修改</strong><br>CSS 预处理器由 less 改成了 Sass，Sass 编译器无需进行额外安装，在 Odoo 12的 Python 依赖中已经安装了libsass-python。做出这一更改的原因有：Bootstrap 4由 less 调整为 Sass，已有 Python绑定和避免对 Node.js（或 Ruby）的依赖。</p>
</blockquote>
<h3 id="源码安装-Odoo-1"><a href="#源码安装-Odoo-1" class="headerlink" title="源码安装 Odoo"></a>源码安装 Odoo</h3><p>为便于管理，我们将在家目录下创建一个&#x2F;odoo-dev目录作为工作目录。在本系列文章中我们均假设 Odoo 安装在&#x2F;odoo-dev目录下。</p>
<p>Odoo 使用的是 Python 3（3.5或之后的版本），那么在命令行中我们将不再使用python和pip，而是用python3和 pip3。</p>
<blockquote>
<p><strong>ℹ️Odoo 11的修改</strong><br>从版本11开始，Odoo 运行在 Python 3.5及以后的版本上，Odoo 11依然支持 Python 2.7，但 Odoo 12仅能运行在Python 3.5+的环境中。Odoo 10及之前的版本仅可运行在Python 2.7上。</p>
</blockquote>
<p>要从源码安装 Odoo，我们首先要从 GitHub 上克隆一套 Odoo 源代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/odoo-dev # 创建工作目录</span><br><span class="line">cd ~/odoo-dev # 进入工作目录</span><br><span class="line">git clone https://github.com/odoo/odoo.git -b 12.0 --depth=1 # 获取 Odoo 源码</span><br></pre></td></tr></table></figure>

<p>~是用户家目录的简写，比如&#x2F;home&#x2F;alan。</p>
<p>如果使用 WSL Windows 子系统，家目录存放在一个Windows 系统文件夹中一个不易于发现的地方。避免这一情况的一个方法是把工作文件放在常用的文件夹下，然后在子系统中使用软链接（类似 Windows中的快捷方式）。比如mkdir &#x2F;mnt&#x2F;c&#x2F;Users&#x2F;Public&#x2F;odoo-dev创建C:\Users\Public\odoo-dev工作目录，然后ln -s &#x2F;mnt&#x2F;c&#x2F;Users&#x2F;Public&#x2F;odoo-dev <del>&#x2F;odoo-dev创建</del>&#x2F;odoo-dev Linux目录，实际上是 Windows 目录的链接。现在就可以使用~&#x2F;odoo-dev运行所有的命令，比如前述的 git clone，文件将存放在C:\Users\Public\odoo-dev下。</p>
<p>Git命令中的-b 12.0明确表明要下载 Odoo 12.0分支，在写本文时，这显得有些多余，因为这正是当前默认的分支。–depth&#x3D;1表示仅下载当前修订版本，而不是所有历史修改记录，这会使下载更快、内容更少。</p>
<blockquote>
<p><strong>小贴士：</strong> 如需在后续下载历史提交内容，可以运行git fetch –unshallow</p>
</blockquote>
<p>在运行 Odoo 之前，应安装requirements.txt中所声明的 Python 依赖：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install -r ~/odoo-dev/odoo/requirements.txt</span><br></pre></td></tr></table></figure>

<p><strong>补充：</strong> 安装时如因requirements.txt指定了Babel&#x3D;&#x3D;2.3.4而报错，请修改Babel&#x3D;&#x3D;2.3.4为Babel或 Babel&gt;&#x3D;2.3.4后再重新执行以上命令；另内存过小也可能导致不易察觉报错，测试时1G 内存报错，调整为2G 后正常安装</p>
<p>这其中的很多依赖都可以通过 Debian 包安装，如python3-lxml，所以使用 apt 包管理器是一个有效的替代方案。这样的优势是在必要时可以自动安装系统依赖，使用的依赖列表可以在.&#x2F;odoo&#x2F;debian&#x2F;control中找到。</p>
<p>还有一些requirements.txt中未包含的 Python 包，亦可安装来避免警告或用于开启额外的功能：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install num2words phonenumbers psycopg2-binary watchdog xlwt</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>小贴士：</strong> pip3工具可以通过好几种方式安装：系统包的方式和原生 Python 的方式。如果pip3报了 import error，在系统中重新安装或能解决问题。对应的命令为sudo python3 -m pip uninstall pip &amp;&amp; sudo apt install python3-pip –reinstall</p>
</blockquote>
<p>现在，通过如下命令可启动 Odoo 实例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/odoo-dev/odoo/odoo-bin</span><br></pre></td></tr></table></figure>

<p>如需停止服务并回到命令行，按下 Ctrl + C。</p>
<blockquote>
<p><strong>小贴士：Odoo 10中的修改</strong><br>现在启动 Odoo的脚本是.&#x2F;odoo-bin，而之前的 Odoo 版本中为.&#x2F;odoo.py</p>
</blockquote>
<p>默认Odoo 实例监听8069端口，所以在浏览器中访问http:&#x2F;&#x2F;<server-address>:8069 就可以访问到 Odoo 实例。对于开发者来说，我们会需要使用到多个数据库，所以在命令行中创建会更为方便，后面会介绍如何实现。现在在命令行终端中按下Ctrl + C 停止 Odoo 服务并回到命令行。</p>
<h3 id="初始化新的-Odoo-数据库"><a href="#初始化新的-Odoo-数据库" class="headerlink" title="初始化新的 Odoo 数据库"></a>初始化新的 Odoo 数据库</h3><p>要按照 Odoo 的数据模式创建和初始化 Odoo 数据库，我们应使用-d 参数运行 Odoo 服务：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/odoo-dev/odoo/odoo-bin -d testdb</span><br></pre></td></tr></table></figure>

<p>初始化 testdb 数据库可能要花上一分钟，一般会以Modules loaded的 INFO 日志信息结束。它有可能不是最后一条日志信息，但在倒数三到四行中可以找到。此时，服务器就可以监听用户请求了。</p>
<blockquote>
<p><strong>ℹ️Odoo 9中的修改</strong><br>从 Odoo 9开始，如果数据库不存在会被自动创建。但在 Odoo 8中并非如此，需使用PostgreSQL命令行中的createdb命令手动创建</p>
</blockquote>
<p>默认情况下，数据库初始化时会带有演示数据，作为开发数据库这通常很有用。相当于在前端创建数据库时勾选了Load demonstration data。如在初始化时无需带有演示数据，在命令行中添加–without-demo&#x3D;all。</p>
<blockquote>
<p><strong>小贴士：</strong> 在写本文时Ubuntu WSL中有一个针对 PostgreSQL 的问题，该环境下无法新建空数据库。一个解决方案是手动通过createdb 12-library命令创建空数据库。这样会重复提示WARNING: could not flush dirty data: Function not implemented。虽然存在警告信息，但数据库正常创建了。按下Ctrl + C停止警告，使用命令行即可启动 Odoo 并初始化数据库。</p>
</blockquote>
<p>当前用户需要是 PostgreSQL 的超级用户才能创建新数据库，前文中在安装过程中已经进行相关操作。</p>
<blockquote>
<p><strong>小贴士：</strong> 对于开发环境，使用数据库超级用户来运行 Odoo 实例毫无问题。但在生产环境中，Odoo最佳安全实践推荐不要使用数据库超级用户权限的用户来运行生产实例。</p>
</blockquote>
<p>Odoo 实例已经运行起来了，现在我们可以通过http:&#x2F;&#x2F;<server-name>:8069在浏览器中进行访问。这时会出现登录界面，如果不知道主机名可以通过 hostname 命令查看或通过 ifconfig 查看 IP 地址。默认管理员的用户名和密码均为 admin。登录后即可看到 Apps菜单，及可安装的应用。</p>
<p>在命令终端中按下Ctrl + C可以停止 Odoo 服务实例并回到命令行。按下上方向键可以回到上一条命令，这样可以通过同样的命令再次快速启动 Odoo。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d5d1ab86cd6d430094d2344479650876~tplv-k3u1fbpfcp-zoom-1.image" alt="Odoo 12后台界面"></p>
<h2 id="管理-Odoo-数据库"><a href="#管理-Odoo-数据库" class="headerlink" title="管理 Odoo 数据库"></a>管理 Odoo 数据库</h2><p>前面我们学习了如何通过命令行创建和初始化 Odoo 数据库。管理数据库还有更多的命令值得我们学习。虽然 Odoo 服务可以自动地进行数据库管理，我们还是可以使用如下命令来手动创建 PostgreSQL 数据库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">createdb MyDB</span><br></pre></td></tr></table></figure>

<p>更有趣的是，Odoo 可以通过–template 参数拷贝已有数据库来创建新的数据库。要进行这一操作，被拷贝的数据库不能被连接，所以要确保 Odoo 实例已停止并且没有其它应用连接该数据库。命令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">createdb --template=MyDB MyDB2</span><br></pre></td></tr></table></figure>

<p>事实上，每当创建数据库时都会使用一个模板，如果没有指定模板，会使用一个名为 template1的预设模板。</p>
<p>要在系统中列出已有数据库，需要使用 PostgreSQL 的 psql 工具及-l 参数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql -l</span><br></pre></td></tr></table></figure>

<p>执行上述命令会列出我们截至目前所创建的数据库。如果执行了前述操作，可以看到列表中有MyDB和MyDB2。列表中还会显示 每个数据库所使用的编码，默认为UTF-8，这也是 Odoo 所需要的数据库编码。</p>
<p>如需删除数据库，执行dropdb命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dropdb MyDB2</span><br></pre></td></tr></table></figure>

<p>现在我们已学习了数据库的基本知识。要了解更多 PostgreSQL请参见<a target="_blank" rel="noopener" href="https://www.postgresql.org/docs/">官方文档</a>或<a target="_blank" rel="noopener" href="https://alanhou.org/postgresql/">PostgreSQL使用汇总</a>。</p>
<blockquote>
<p><strong>警告：</strong> dropdb操作是不可撤销的，在对重要数据库执行该命令时请务必备份数据库</p>
</blockquote>
<h2 id="其它服务器配置项"><a href="#其它服务器配置项" class="headerlink" title="其它服务器配置项"></a>其它服务器配置项</h2><p>Odoo 服务还支持一些其它参数，可通过–help 来查看更多参数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/odoo-dev/odoo/odoo-bin --help</span><br></pre></td></tr></table></figure>

<p>我们在下面的部分将会学习一些重要参数，首先我们先学习下如何把当前使用参数保存到配置文件中。</p>
<h3 id="Odoo-服务配置文件"><a href="#Odoo-服务配置文件" class="headerlink" title="Odoo 服务配置文件"></a>Odoo 服务配置文件</h3><p>大多数的参数都可以保存到配置文件中。默认 Odoo 使用.odoorc文件。Linux 系统中缺省的路径是在家目录（$HOME）中，而在 Windows 中则和运行 Odoo 的可执行文件放在同一个目录中。</p>
<blockquote>
<p>ℹ️在老版本的 Odoo&#x2F;OpenERP 中，默认的配置文件为.openerp-serverrc，为保持向后兼容，存在该文件且没有.odoorc文件的情况下会使用该文件。</p>
</blockquote>
<p>一个全新安装中不会自动创建.odoorc配置文件，我们应使用–save参数来保存，如果配置文件不存在则会创建默认配置文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/odoo-dev/odoo/odoo-bin --save --stop-after-init</span><br></pre></td></tr></table></figure>

<p>此处我们还使用–stop-after-init参数以在执行结束后停止服务。这一参数常在运行测试或要求运行模块升级来检测是否正确安装时使用。</p>
<blockquote>
<p>小贴士：命令行参数可以缩短到保持不混淆的程度，如–stop-after-init可缩写为–stop。</p>
</blockquote>
<p>现在可以通过如下命令来查看缺省配置文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">more ~/.odoorc # 显示配置文件</span><br></pre></td></tr></table></figure>

<p>以上命令会显示所有配置项及配认值，编辑文件后在下一次启动 Odoo 实例后生效，输入 q 回到命令行。</p>
<p>我们还可以使用–conf(或-c)参数来指定配置文件。配置文件无需包含所有配置项，仅包含需修改默认值的配置项即可。</p>
<h3 id="修改监听端口"><a href="#修改监听端口" class="headerlink" title="修改监听端口"></a>修改监听端口</h3><p>–http-port&#x3D;（或-p）参数可以修改实例的监听端口（默认端口8069），不同的端口可以让我们在同一台机器上运行多个实例。</p>
<blockquote>
<p><strong>Odoo 11的修改：</strong> 在 Odoo 11中引入–http-port参数以替代此前版本使用的–xmlrpc-port</p>
</blockquote>
<p>下面就可以做个尝试，打开两个终端，第一个中输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/odoo-dev/odoo/odoo-bin --http-port=8070</span><br></pre></td></tr></table></figure>

<p>第二个中输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/odoo-dev/odoo/odoo-bin --http-port=8071</span><br></pre></td></tr></table></figure>

<p>此时就在同一台机器上使用不同端口运行了两个 Odoo 实例，这两个实例可以使用同一个数据库或不同数据库。这取决于我们使用的配置参数，并且两个端口上也可以运行相同或不同版本的 Odoo。</p>
<blockquote>
<p><strong>小贴士：</strong> 不同 Odoo 版本必须使用不同的数据库。尝试在不同版本上使用相同数据库将无法正常运行，因为各大版本采用了不兼容的数据库模式。</p>
</blockquote>
<h3 id="数据库选项"><a href="#数据库选项" class="headerlink" title="数据库选项"></a>数据库选项</h3><p>进行 Odoo 开发时，经常会使用多个数据库，有时还会用到不同版本。在同一端口上停止、启动不同服务实例，或在不同数据库间切换，会导致网页客户端会话异常。因为浏览器会存储会话的 Cookie。</p>
<p>在浏览器中使用私有模式访问实例可以避免这一问题。另一优良实践是在服务实例上开启数据库过滤器，这样可以确保实例仅允许对指定数据库的请求，而忽略其它请求。</p>
<blockquote>
<p><strong>Odoo 11中的修改：</strong><br>从Odoo 11开始，–database（或-d）参数可接收逗号分隔的多个数据库名，设置–database参数时也会自动设置–db-filter参数，这样仅有这个数据库才能为服务实例使用。对于 Odoo 11之前的版本，我们需要使用–db-filter来限制可访问的数据库。</p>
</blockquote>
<p>–db-filter可限制 Odoo 实例所能使用的数据库。它接收一个正则表达式来过滤可用数据库名，要精确匹配一个名称，表达式需要以^开头并以$结束。例如，仅允许testdb数据库，我们可以使用如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/odoo-dev/odoo/odoo-bin --db-filter=^testdb$</span><br></pre></td></tr></table></figure>

<p>使用–database和–db-filter参数来匹配同一数据库是一个良好的实践。事实上从 Odoo 11开始默认会为–database设置对应的–db-filter。</p>
<h3 id="管理服务器日志消息"><a href="#管理服务器日志消息" class="headerlink" title="管理服务器日志消息"></a>管理服务器日志消息</h3><p>–log-level 参数可用于设置日志级别，这有助于了解服务的状况。例如要开始调试日志级别，使用–log-level&#x3D;debug参数。还有如下选项：</p>
<ul>
<li>debug_sql：查看服务中产生的 SQL 查询</li>
<li>debug_rpc：服务器接收到的请求详情</li>
<li>debug_rpc_answer：服务器发送的响应详情</li>
</ul>
<p>其实–log-level是设置Odoo 日志级别的简化方式，此外通过更完整的–log-handler参数可以有选择地打开&#x2F;关闭日志记录器。默认情况下日志会作为标准输出（打印到屏幕），但是可以通过logfile&#x3D;参数来指定日志存储文件。</p>
<h2 id="安装第三方插件"><a href="#安装第三方插件" class="headerlink" title="安装第三方插件"></a>安装第三方插件</h2><p>在 Odoo 实例中产生新的模块并安装，对于初学者总会容易搞不清。下面一起来熟悉这一点。</p>
<h3 id="查找社区模块"><a href="#查找社区模块" class="headerlink" title="查找社区模块"></a>查找社区模块</h3><p>网络上有很多 Odoo 模块，<a target="_blank" rel="noopener" href="https://apps.odoo.com/">Odoo应用商店</a>可以下载一系列模块安装到系统中。另一个重要的资源是Odoo 社区联盟(OCA - Odoo Community Association)维护的模块，可在 <a target="_blank" rel="noopener" href="https://github.com/OCA/">GitHub</a> 上查找。OCA 是一个协调社区贡献的非营利组织，它同时提升软件质量，推广最佳开发实践和开源价值观。可通过<a target="_blank" rel="noopener" href="https://odoo-community.org/%E6%9D%A5%E8%BF%9B%E4%B8%80%E6%AD%A5%E4%BA%86%E8%A7%A3">https://odoo-community.org/来进一步了解</a> OCA。</p>
<p>为 Odoo 添加模块，仅需将其拷贝到官方插件的 addons 文件夹中即可，按前述安装即为~&#x2F;odoo-dev&#x2F;odoo&#x2F;addons&#x2F;。但这不是一个好的实践，我们安装的 Odoo 是由 Git 版本控制的代码仓库，将会与上游 GitHub 仓库保持同步，在其中加入外部插件会不利于管理。</p>
<p>避免这一点，我们可以选取一个或多个存放模块的目录，让 Odoo 服务也会从该目录中查找模块来使用。我们不仅可以把自定义模块放在一个不同的目录下不与官方的混在一起，还可以通过不同目录组织这些模块。</p>
<p>我们可以通过下载系统课程的代码来准备供 Odoo 安装的插件模块，获取 GitHub 上的源码，执行如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/odoo-dev</span><br><span class="line">git clone https://github.com/alanhou/odoo12-development.git library</span><br></pre></td></tr></table></figure>

<p>此时与&#x2F;odoo同级的&#x2F;library文件夹中将包含一些模块，现在就需告知 Odoo 这个新的模块目录。</p>
<h3 id="配置插件-add-ons-路径"><a href="#配置插件-add-ons-路径" class="headerlink" title="配置插件(add-ons)路径"></a>配置插件(add-ons)路径</h3><p>Odoo 服务有一个addons_path参数可设置查找插件的路径，默认指向Odoo 服务所运行处的&#x2F;addons文件夹。我们可以指定多个插件目录，这样就可以把自定义模块放到另一个目录下，无需与官方插件混到一起。</p>
<p>通过如下命令可包含新的模块路径来运行服务：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/odoo-dev/odoo</span><br><span class="line">./odoo-bin -d 12-library --addons-path=&quot;../library,./addons&quot;</span><br></pre></td></tr></table></figure>

<p>仔细看服务日志，会发现有一行报告插件路径，信息类似INFO ? odoo: addons paths: […]，确认下里面是否有library&#x2F;目录。</p>
<h2 id="使用-Python-虚拟环境安装-Odoo"><a href="#使用-Python-虚拟环境安装-Odoo" class="headerlink" title="使用 Python 虚拟环境安装 Odoo"></a>使用 Python 虚拟环境安装 Odoo</h2><p>维护多个 Odoo 版本的代码在 Odoo 开发中很常见，需要整理一下来保持项目在同一台开发机器上并行。改变版本有时会需要上下文的切换。比如，现在 Odoo 的启动执行文件是odoo-bin，而在老版本中是odoo.py。迁移到 Python 3后又更易混淆了，我们要知道是选择python&#x2F;pip还是python3&#x2F;pip3，这取决于使用的 Odoo 版本。</p>
<p>Python 有一个在同机器上管理独立环境的工具virtualenv。每个环境有自己的Python 可执行文件和库文件，仅需在使用时激活环境，然后python和 pip 无需指定就可以在相应的安装了 Python库的环境下运行。要在Debian&#x2F;Ubuntu上使用virtualenv，执行如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install virtualenv -y</span><br></pre></td></tr></table></figure>

<p>如果我们使用的工作目录是<del>&#x2F;odoo-dev，并把 Odoo 12源代码克隆到</del>&#x2F;odoo-dev&#x2F;odoo目录中，我们可以这样进行虚拟环境的创建：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">virtualenv -p python3 ~/odoo-dev/odoo12env</span><br><span class="line">source ~/odoo-dev/odoo12env/bin/activate</span><br></pre></td></tr></table></figure>

<p>一旦激活了虚拟环境，我们可以在其中安装 Odoo，可以通过 pip 来进行操作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -e ~/odoo-dev/odoo</span><br></pre></td></tr></table></figure>

<p>以上代码会将~&#x2F;odoo-dev&#x2F;odoo中的 Odoo源代码安装到虚拟环境中。-e 参数非常重要，这是一个可编辑安装。它不会复制一份代码到虚拟环境中，仅仅只是保留了一个到原地址 Odoo 代码的引用。因为使用到了源代码，源代码的修改在当前环境中也同样生效。</p>
<p>Odoo 的 Python 依赖会被自动安装，所以无需使用requirements.txt来进行手动安装。我们也可以通过 pip 来安装其它所需的 Python 库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install phonenumbers num2words psycopg2-binary watchdog xlwt</span><br></pre></td></tr></table></figure>

<p>注意我们无需记住使用的是 Python 2还是 Python 3，这里的pip 命令会指向正确的版本。然后就可以运行 Odoo 了，pip 安装创建了一个bin&#x2F;odoo命令，可在任何位置运行，无需涉及源代码所在目录。</p>
<blockquote>
<p><strong>小贴士：</strong> 如果决定使用虚拟环境，任何要使用odoo-bin运行的命令，都可以替换为 odoo</p>
</blockquote>
<p>以下命令会启动并关闭所安装版本 Odoo，打印一些日志信息用于确定 Odoo 版本和使用的插件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">odoo --stop-after-init</span><br></pre></td></tr></table></figure>

<p>推荐的操作是将配置文件放在虚拟环境文件夹中。以下会为我们的项目初始化一个12-library 数据库，并创建一个对应的12-library.conf 文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">odoo -c ~/odoo-dev/odoo12-env/12-library.conf -d 12-library --addons-path=~/odoo-dev/library,~/odoo-dev/odoo/addons --save --stop</span><br></pre></td></tr></table></figure>

<p>自此开始，我们可通过如下命令启动图书项目 Odoo 服务：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">odoo -c ~/odoo-dev/odoo12-env/12-library.conf</span><br></pre></td></tr></table></figure>

<p>最后在完成后，通过如下命令来退出环境：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deactivate</span><br></pre></td></tr></table></figure>

<p>假设我们要在同一台机器上使用 Odoo 10项目，它使用的是 Python 2.7，通过如下命令创建环境、安装 Odoo：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd ~/odoo-dev</span><br><span class="line">git clone https://github.com/odoo/odoo.git -b 10.0 --depth=1 odoo10</span><br><span class="line">virtualenv odoo10env</span><br><span class="line">source odoo10env/bin/activate</span><br><span class="line">pip install -e ./odoo10</span><br><span class="line">odoo --version</span><br><span class="line">deactivate # To finish working with this env.</span><br></pre></td></tr></table></figure>

<p>要使得在 Odoo 版本间切换更容易，我们可以在~&#x2F;odoo-dev&#x2F;odoo10目录下再为10.0分支克隆一份源代码。然后创建虚拟环境，激活环境，使用 pip创建一个 Odoo 10可编辑安装。virtualenv没有使用-p 参数指定 Python 版本，默认为 Python 2，也就是 Odoo 10所需的版本。</p>
<p>如果系统中没有 Python 2，Ubuntu 18.04默认就不带 Python 2，则需要执行如下命令来进行安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install python-dev</span><br></pre></td></tr></table></figure>

<h3 id="使用-PyPI-下载和安装插件模块"><a href="#使用-PyPI-下载和安装插件模块" class="headerlink" title="使用 PyPI 下载和安装插件模块"></a>使用 PyPI 下载和安装插件模块</h3><p>社区贡献的插件可以打包成 Python 库，发布到 Python 包索引(PyPI -Python Package Index)，然后像其它库一样使用 pip 安装。为了能使用这一方法，Odoo 自动添加了site-packages&#x2F;文件夹至插件配置路径，用于安装库文件。打包可以通过<a target="_blank" rel="noopener" href="https://pypi.org/project/setuptools-odoo/">setuptools-odoo</a>工具。</p>
<p>OCA 项目使用该工具打包并发布插件至 PyPI。因不同 Odoo 版本中存在相同模块，模块名之前会加一个 Odoo 版本前缀。例如odoo12-addon-partner-fax 是Odoo 12的<a target="_blank" rel="noopener" href="https://pypi.org/project/odoo12-addon-partnerfax/">partner_fax</a> PyPI 包，它为 partner 添加了一个传真字段。</p>
<p>如需从 PyPI 下载该模块及依赖，并随后安装至odoo12env环境，使用如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">source ~/odoo-dev/odoo12env/bin/activate</span><br><span class="line">pip install odoo12-addon-partner-fax</span><br><span class="line">odoo -c ~/odoo-dev/odoo12-env/12-library.conf -i partner_fax --stop</span><br></pre></td></tr></table></figure>

<h2 id="服务器端开发者模式"><a href="#服务器端开发者模式" class="headerlink" title="服务器端开发者模式"></a>服务器端开发者模式</h2><p>为便于开发者，Odoo 有一个–dev&#x3D;all参数可激活一些开发者友好的功能。</p>
<blockquote>
<p>**Odoo 10中的修改：<br>**–dev&#x3D;…参数是在 Odoo 10中引入的，它取代了此前版本中更简单、功能也更少的–debug参数</p>
</blockquote>
<p>这启用了一些有用的功能可加快开发流程，最重要的如下：</p>
<ul>
<li>在保存 Python 文件时自动重载 Python 代码，避免手动重启服务</li>
<li>从 XML 中直接读取 view 定义，避免手动升级模块</li>
</ul>
<p>–dev&#x3D;all将在抛出异常时启动 Python调试器(pdb)，在服务报错后做后验(postmortem)分析非常有益。注意这一设置对日志输出不产生任何影响。有关 Python 调试器命令详情可参见<a target="_blank" rel="noopener" href="https://docs.python.org/3/library/pdb.html#debugger-commands">Python 官方文档</a>。</p>
<p>虽然 all 值适用于大多数情况，–dev还可接一串逗号分隔的选项。缺省情况下会使用Python 调试器 pdb。有些人会倾向安装、使用其它调试器，来改善功能和易用性。Odoo 是允许我们指定调试器的，常用的有ipdb和pudb。在本系列第八篇<a target="_blank" rel="noopener" href="https://alanhou.org/odoo12-business-logic/">Odoo 12开发之业务逻辑 - 业务流程的支持</a>中，我们将介绍如何在 Odoo 开发中使用调试器。</p>
<p>要自动侦测代码文件的变化 ，服务开发者模式需安装一个额外的依赖python3-watchdog。我们需要在Ubuntu&#x2F;Debian系统中安装它之后才可使用，命令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python3-watchdog</span><br></pre></td></tr></table></figure>

<p>对于 Odoo 11之前的版本，使用的是 Python 2，则需安装python-watchdog。同样可使用 pip 安装，命令为pip install watchdog。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在本文中，如们学习了如何在 Ubuntu 系统中安装 Odoo 并从 GitHub 上获取 Odoo源码，以及如何创建Odoo 数据库和运行 Odoo 实例。</p>
<p>现在我们的 Odoo 环境可正常用于开发，并且也可以对数据库和实例进行管理。有了这些，我们可以进行一步的学习了。在下一篇文章中，我们将从零开始创建第一个 Odoo 模块，并理解相关的主要元素。</p>
<p> </p>
<p>☞☞☞ 接下来请学习<a target="_blank" rel="noopener" href="https://alanhou.org/odoo12-first-application/">Odoo 12 开发之创建第一个 Odoo 应用</a></p>
<p>本文首发地址：<a target="_blank" rel="noopener" href="https://alanhou.org/developer-mode-odoo12/">Alan Hou 的个人博客</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://alanhou.github.io/2018/12/30/odoo-essentials-12-chapter1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Alan Hou">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Alan Hou的个人博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Alan Hou的个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/12/30/odoo-essentials-12-chapter1/" class="post-title-link" itemprop="url">第一章 使用开发者模式快速入门 Odoo 12</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-12-30 00:00:00" itemprop="dateCreated datePublished" datetime="2018-12-30T00:00:00+08:00">2018-12-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-02-03 13:31:42" itemprop="dateModified" datetime="2023-02-03T13:31:42+08:00">2023-02-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>本文为<a target="_blank" rel="noopener" href="https://alanhou.org/developer-mode-odoo12">最好用的免费ERP系统Odoo 12开发手册</a>系列文章第一篇。</p>
<p>Odoo提供了一个快速应用开发框架，非常适合创建商业应用。这类应用通常用于保留业务记录，增删改查操作。Odoo 不仅简化了这类应用的创建，还提供了看板、日历、图表等视图的丰富组件，用于创建好看的用户界面。</p>
<p>本文主要内容有：</p>
<ul>
<li>引入本文使用的学习项目：to-do (任务清单)应用</li>
<li>理解 Odoo 的结构、版本和发布，了解使用 Odoo 的相关知识</li>
<li>准备一个 Odoo 的基本工作环境，有如下选项：<ul>
<li>在线Odoo</li>
<li>Windows 一键安装包</li>
<li>Docker</li>
</ul>
</li>
<li>激活开发者模式，在用户界面中展示所需使用的工具</li>
<li>修改已有模型，添加字段，常用自定义快速入门</li>
<li>创建自定义数据模型，为我们的应用添加新的数据结构</li>
<li>配置权限，让指定用组组访问应用的功能</li>
<li>创建菜单项，在用户界面中展示新的数据模型</li>
<li>创建用户界面的基本组件：列表、表单、搜索视图</li>
</ul>
<h2 id="引入-to-do-列表应用"><a href="#引入-to-do-列表应用" class="headerlink" title="引入 to-do 列表应用"></a>引入 to-do 列表应用</h2><p><a target="_blank" rel="noopener" href="http://todomvc.com/">TodoMVC</a> 项目提供一个多 JavaScript 框架实现的 to-do  简单应用类比。下面我们就用 Odoo 来创建一个简单的 to-do 应用。</p>
<p>使用这个应用我们可以添加新的 to-do 项，然后标记完成。比如可在项目中添加<em>买鸡蛋</em>，然后在购买后勾选<em>已完成</em>。To-do 项目应仅对当前用户可见，因而每个人可以获取自己的 to-do 列表。对于一个简易 to-do 应用这已足够，但为增加点趣味性，我们还将取允许 to-do 列表项目包含一组和任务相关的用户，即工作小组。</p>
<p>就该应用我们应考虑以下几层：</p>
<ul>
<li>数据层：通过模型实现</li>
<li>逻辑层：通过自动化编码实现</li>
<li>展示层：通过视图实现</li>
</ul>
<p>对于数据层，我们需要一个 To-do 项目模型，我们还将利用内置的 partner(或 contacts)模型来支持工作组的功能。当然还要记得在新的模型中配置访问权限。</p>
<p>逻辑层中我们使用框架处理增删改查(CRUD)基本操作，要使用框架的功能，我们需要在开发者模块中使用 Python 代码。对于初学者，可以使用用户界面开发者菜单automate 工具来实现业务逻辑，后面的例子中会进行说明。</p>
<p>展示层中我们将为应用添加菜单选项，以及 to-do 模型的视图。业务应用的基本视图是用于查看已有记录的列表视图、深入查看记录细节的表单视图。为增强易用性，我们还可以在列表视图中的搜索框预置过滤项。可用搜索选项也被视为一个视图，因而通过搜索视图可进行实现。</p>
<p>以下是创建 to-do 列表应用的步骤</p>
<ol>
<li>创建 to-do 项的新模型，然后添加菜单让其可见</li>
<li>为 to-do 项模型创建列表和表单视图，新模型包含如下字段<ul>
<li>Description: text 类型</li>
<li>Is Done?标记：布尔型</li>
</ul>
</li>
</ol>
<p>应用的具体功能包含添加执行同一任务的一组用户，因此需要一个表示用户的模型。所幸 Odoo 自带就有这带的模型 - partner 模型(res.partner)，它可用于存储个人、公司和地址。并且仅有指定的人可被选择加入工作团队，因此我们需要修改 partner 模型添加Is Work Team?标记。</p>
<p>所以，to-do 项模型还应包含一个工作团队字段，包含一组用户。在添加了Is Work Team?标记后这些关联用户可在 partners&#x2F;contacts 中进行选取。</p>
<p>综上，我产需要做的有：</p>
<ul>
<li>为 partner 模型和表单视图添加字段</li>
<li>创建一个 to-do 项模型</li>
<li>创建一个 to-do 应用菜单项</li>
<li>创建 to-do 项用户界面：列表、表单视图以及 UI 中的搜索选项</li>
<li>创建访问权限：组、权限控制列表（ACL）和记录规则</li>
</ul>
<p>在落地实现之前，我们先要讨论下 Odoo 框架的基本概念，然后学习如何准备工作环境。</p>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>理解 Odoo 结构中的各个层以及我们要使用的各类型组件的作用大有裨益。下面我们先概览下 Odoo 应用结构，然后把应用开发解构为对应组件。</p>
<p>然后 Odoo 发布有两个版本的定期更新：社区版和企业版，我们应了解两者之前的差别以及大版本发布对开发和部署所带来的变化。首先来看看 Odoo 的应用结构：</p>
<h3 id="Odoo-结构"><a href="#Odoo-结构" class="headerlink" title="Odoo 结构"></a>Odoo 结构</h3><p>Odoo 遵循多层结构，即前述的数据层、逻辑层和展示层:</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8be981364aa04dc7a4a92c5a70613340~tplv-k3u1fbpfcp-zoom-1.image" alt="Odoo 的多层结构"></p>
<p>数据层是最底端的层，负责数据持久化存储，Odoo 借助 PostgreSQL来实现。Odoo 出于设计考虑仅支持 PostgreSQL 数据库，而不支持MySQL 这一类数据库（有第三方应用可集成 MySQL）。文件附件、图片一类的二进制文件通常存储在一个称为 filestore（目录） 的文件系统中。</p>
<blockquote>
<p><strong>小贴士：</strong> 也就说 Odoo 实例的完整备份需包含数据库和 filestore 的拷贝。</p>
</blockquote>
<p>逻辑层负责与数据层的所有交互，并由 Odoo 服务器完成。通常，底端数据库不应通过这一层获取，只有这样才能保证权限控制和数据一致性。在 Odoo的核心代码中包含供这一接口使用的 ORM (Object-relational Mapping)引擎。ORM 提供插件模块与数据交互的 API。</p>
<p>比如像客户和供应商这样的 partner 数据实体，是通过模型的 ORM 体现的。这一模型是一个 Python 对象，支持多种交互方法：create()方法用于创建新的伙伴记录，read()方法用于查询已有记录和对应数据。通用方法可在特定模型中实现指定业务逻辑，如 create()方法可以设置默认值或强化验证规则，read()方法可支持一些自动计算字段或根据执行操作用户来实施权限控制。</p>
<p>展示层用于展示数据并与用户交互，通过客户端实现用户体验。客户端与 ORM API 交互来读、写、验证或执行其它操作，通过 RPC 调用 ORM API 方法。这些操作发往 Odoo 服务器端操作，然后结果发送回客户端做进一步处理。</p>
<p>对于展示层，Odoo 自带全面功能的 web 客户端。该客户端支持所有业务应用所需功能：登录会话、导航菜单、数据列表、表单等等。全局展示不会像前端工程师所认为的那样可定制，但易于创建功能性和连贯的用户体验。配套的展示层包含网站框架，可像其它 CMS 框架一样灵活地创建网页，当然需要额外的操作和 web 相关知识。网站框架支持通过 web 控制器实现代码来展示特定逻辑，而与模型内在逻辑进行区隔。前端工程师不会有什么操作上的障碍。</p>
<p>Odoo 服务端 API 非常开放，包含所有服务端功能。web 客户端使用的 API 与其它应用的 API 并无不同。因此，其它的客户端实现均可做到，并且可以在任何平台上使用任意编程语言进行实现。可以创建桌面和移动端应用来提供不同用户界面，这充分利用了 Odoo 为业务逻辑和数据持久性而生的数据和逻辑层。</p>
<h3 id="Odoo社区版-vs-企业版"><a href="#Odoo社区版-vs-企业版" class="headerlink" title="Odoo社区版 vs. 企业版"></a>Odoo社区版 vs. 企业版</h3><p>Odoo 是这款软件的名称，同时也是发布软件的公司。Odoo 采取核心开源的业务模式，社区版（CE）完全免费开源，而企业版（EE）则是一款付费产品。社区版提供了全部的框架功能和大多数与 Odoo 捆绑的业务应用基础功能。Odoo 采取 LGPL 开源协议，允许在开源模块之上添加专属扩展。企业版建立在社区版基础之上，包含社区版所有功能和额外的独有功能。值得一提的是企业版带有一个移动端优化的用户界面，两个版本的用户界面底层完全相同。Odoo 在线 SaaS 服务使用的是企业版，会部署一些企业版大版本发布之后的一些中间版本。</p>
<h3 id="Odoo-的版本政策"><a href="#Odoo-的版本政策" class="headerlink" title="Odoo 的版本政策"></a>Odoo 的版本政策</h3><p>在写本文时，Odoo 的稳定版本号是12，在 GitHub 上的分支为12.0，这也是本系列文章所采用的版本。近年来 Odoo 的大版本都是按年发布， Odoo 12是在10月份的 Odoo 体验大会上发布的。官方支持最近的三个稳定版本，在12.0发布时，官方仍然维护11.0和10.0两个版本，而停止对9.0的支持，这也就意味着不再对 bug和安全漏洞进行修复。</p>
<p>应当注意 Odoo 不同大版本间的数据库并不兼容，比如在 Odoo 11服务端运行早前版本的 Odoo 数据库，系统将无法运行。在不同版本间迁移数据库也颇费周折。对于插件模块也是如此，通常老版本中开发的插件无法在新版本中生效，所以在网上下载社区模块时，应注意选择对应的版本。</p>
<p>此外，大版本（如10.0， 11.0）会被频繁的更新，但这些通常仅仅是 bug 的修复。这些修复会确保 API 稳定，也就是模型数据结构和视图元素标识符也会保持稳定。这点非常重要，因为这意味着我们的自定义模块不会因上游核心模块的不兼容修改而崩溃。</p>
<p>Master 分支中的版本将产生下一个稳定的大版本，但在形成稳定版之前，将不会保持 API 稳定，我们应避免使用它来创建自定模块。否则会如同在流沙中行进，我们无法保证什么改变会导致自定义模块的崩溃。</p>
<h2 id="基本工作环境的准备"><a href="#基本工作环境的准备" class="headerlink" title="基本工作环境的准备"></a>基本工作环境的准备</h2><p>首先我们需要一个 Odoo 实例来进行学习，本文仅要求运行一个 Odoo 实例，与具体的安装方法无关。想要快速运行，我们可以使用一个预打包的 Odoo 发布，甚或是使用 Odoo SaaS 的<a target="_blank" rel="noopener" href="https://www.odoo.com/trial">试用版本</a>。</p>
<h3 id="使用-Odoo-SaaS试用版本"><a href="#使用-Odoo-SaaS试用版本" class="headerlink" title="使用 Odoo SaaS试用版本"></a>使用 Odoo SaaS试用版本</h3><p>这是最为简便的方法，无需进行任何安装，仅需进入官网<a target="_blank" rel="noopener" href="https://www.odoo.com/trial">创建一个试用数据库</a>。这一 Odoo 云端软件是基于企业版的 SaaS 服务，采用独有的中间版本发布。在写本文时，这一服务不仅支持试用，在仅安装一个应用的情况下可以免费使用。SaaS 服务使用原生的 Odoo 企业版，不支持自定模块。在需要进行自定义时，可使用 <a target="_blank" rel="noopener" href="https://www.odoo.sh/">Odoo.sh 服务</a>，它提供一个可自定义全面功能的开发平台和主机托管方案。</p>
<p><strong>注意：</strong> 在 Odoo 早前版本中，社区版和企业版的菜单结构有相当大的差别，而 Odoo 12中，两者这间的结构相近。</p>
<p>在 Odoo 云端 SaaS 创建新数据库，会需要选择一个应用，针对本文可选择任意应用。在对于有选择尴尬症的朋友，可以使用CRM 客户关系管理应用。另外值得一提的是在 Odoo SaaS企业版中可选择 Odoo Studio 应用构建器，因本系列所针对的社区版并不包含，所以我们不会使用到。Odoo Studio 为开发者提供了一个用户友好的使用界面，还有一些其它功能，如导出在模块包中所做自定义修改。但其主要功能都可在开发者模式中获取。</p>
<h3 id="在-Windows-上安装-Odoo"><a href="#在-Windows-上安装-Odoo" class="headerlink" title="在 Windows 上安装 Odoo"></a>在 Windows 上安装 Odoo</h3><p>一键安装包可以在<a target="_blank" rel="noopener" href="https://download.odoo.com/">Odoo官网</a>上下载，包含各个版本及主分支，这里有 Windows 安装包(.exe)、Debian 安装包(.deb)和 CentOS 安装包(.rpm)。要在 Windows 上安装，仅需在对应版本的 nightly 文件夹中找到.exe 并进行安装。安装包非常方便，它包含所有安装 Odoo 所需的所有部分：Python 3、PostgreSQL 数据库、Odoo 服务端以及其它 Odoo 依赖。安装时会创建一个 Windows 服务在开机时自动启动 Odoo 和 PostgreSQL。</p>
<h3 id="使用-Docker-容器安装-Odoo"><a href="#使用-Docker-容器安装-Odoo" class="headerlink" title="使用 Docker 容器安装 Odoo"></a>使用 Docker 容器安装 Odoo</h3><p>Docker是一个便捷运行应用的跨平台解决方案，可在 MacOS, Linux 和 Windows 上使用。与传统的虚拟机相比，容器技术使用更为简单、资源利用率更高。首先需要在操作系统中安装 Docker，可从<a target="_blank" rel="noopener" href="https://www.docker.com/">Docker官网</a>上下载免费使用的Docker CE（社区版），最新安装方法可在 Docker官网上查看。</p>
<p>应该注意虚拟化要求在 BIOS配置中进行开启，并且 Windows 版本的 Docker CE 需要有 Hyper-V，它仅在 Windows 10 企业版或教育版才会带有(<a target="_blank" rel="noopener" href="https://docs.docker.com/docker-for-windows/install/">Windows 系统要求</a>)，而 Mac系统需要为 OS X El Capitan 10.11或更新版本。对于其它的 Windows 和 MacOS 版本，应安装 <a target="_blank" rel="noopener" href="https://docs.docker.com/toolbox/overview/">Docker Toolbox</a>，Docker Toolbox打包了 VirtualBox 并提供了预设置的 shell，用于作为操作 Docker 容器的命令行环境。</p>
<p>在 <a target="_blank" rel="noopener" href="https://store.docker.com/images/odoo">Odoo 商店</a>中包含 Odoo 镜像，在那里找到对应版本，按照提示进行安装。要使用 Docker运行 Odoo，我们需要两个容器，一个运行 PostgreSQL 数据库，一个运行 Odoo 服务。</p>
<p>安装通过命令行窗口完成，安装 PostgreSQL 容器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -e POSTGRES_USER=odoo -e POSTGRES_PASSWORD=odoo -e POSTGRES_DB=postgres --name db postgres:10</span><br></pre></td></tr></table></figure>

<p>此时便会从互联网上下载最新的 PostgreSQL 镜像，并在后台开启一个容器来进行运行。</p>
<p>接下来安装 Odoo 服务容器，并且连接刚刚启动的 PostgreSQL 容器，暴露8069端口：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 8069:8069 --name odoo --link db:db -t odoo</span><br></pre></td></tr></table></figure>

<p>此时便可在终端窗口看到实时的 Odoo 服务器日志，在浏览器中输入<a target="_blank" rel="noopener" href="http://localhost:8069/">http://localhost:8069</a>即可打开 Odoo 实例。</p>
<blockquote>
<p><strong>小贴士：</strong> 如果8069端口被占用了，则Odoo 服务启动会失败。此时我们需要停止占用端口的服务或者使用-p 参数指定其它端口来运行 Odoo，如修改为8070端口(-p 8070:8069)。此时可能还需要通过-d 参数修改实例所需使用的数据库名称。</p>
</blockquote>
<p>以下Docker 的基本指令会有助于管理容器（更多 Docker 知识请参见<a target="_blank" rel="noopener" href="https://alanhou.org/docker/">CI&#x2F;CD之Docker容器DevOps学习笔记及常见问题</a>）：</p>
<ul>
<li>docker stop <name> 停止指定容器</li>
<li>docker start <name> 启动指定容器</li>
<li>docker start -a <name> 启动容器并附带输出，如命令终端中输出的服务器日志</li>
<li>docker attach <name> 重新添加容器输出至当前终端窗口</li>
<li>docker ps 列出当前 Docker 容器</li>
</ul>
<p>以上就是操作 Docker 容器的基本命令，万一在运行容器时出现问题，可以执行如何命令(可省略 container)重新来过：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker container stop db</span><br><span class="line">docker container rm db</span><br><span class="line">docker container stop odoo</span><br><span class="line">docker container rm odoo</span><br></pre></td></tr></table></figure>

<p>Docker 技术的应用非常广泛，更多知识可参见 <a target="_blank" rel="noopener" href="https://docs.docker.com/">Docker 官方文档</a>。</p>
<h3 id="其它安装选项"><a href="#其它安装选项" class="headerlink" title="其它安装选项"></a>其它安装选项</h3><p>Odoo也有 Linux 系统的安装包，包含 Debian 系（如 Ubuntu）和 Red Hat 系（如 CentOS和 Fedora）。<a target="_blank" rel="noopener" href="https://www.odoo.com/documentation/master/setup/install.html">官方文档</a>中有相关说明，也可参考：</p>
<p><a target="_blank" rel="noopener" href="https://alanhou.org/centos-odoo-12/">CentOS 7快速安装配置 Odoo 12</a></p>
<p><a target="_blank" rel="noopener" href="https://alanhou.org/odoo-12/">Ubuntu 快速安装配置Odoo 12</a></p>
<p>对于源码安装会相对复杂，但可变性也更强，在第二章 准备开发环境中还会详细介绍。</p>
<h3 id="创建工作数据库"><a href="#创建工作数据库" class="headerlink" title="创建工作数据库"></a>创建工作数据库</h3><p>通过前面的学习，我们应该都有一个 PostgreSQL 数据库和 Odoo 服务器供运行。在开始使用我们的项目前还需要再创建一个 Odoo 数据库。如果您在本地安装 Odoo 并保留了默认设置，则可以通过<a target="_blank" rel="noopener" href="http://localhost:8069/">http://localhost:8069/</a>打开 Odoo。第一次打开时，还没有可用的数据库，此时可以看一个用于创建数据库的页面：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/baca0a342788478a86e51360d35b4136~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12创建数据库</p>
<p>创建数据库需的信息有：</p>
<ul>
<li><strong>Database Name：</strong> 数据库的标识名称，在同一台服务器上可以有多个数据库</li>
<li><strong>Email：</strong> 管理员的登录用户名，可以不是 email 地址</li>
<li><strong>Password：</strong> 管理员登录的密码</li>
<li><strong>Language：</strong> 数据库的默认语言</li>
<li><strong>Country：</strong> 数据库中公司数据所使用的国家，这个是可选项，与发票和财务等带有本地化特征的应用有关</li>
<li><strong>Demo data：</strong> 勾选此选项会在数据库中创建演示数据，通常在开发和测试环境中可以勾选</li>
</ul>
<p>如果在 Odoo 的服务端配置中添加了 master password，还会要求输入该密码。这可以阻止未经授权的用户执行相关管理员操作，默认情况下不会设置该密码。 点击 Create database 按钮后，会开始初始化数据库，整个过程可能会需要一到几分钟，结束后会自动登入后台。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b46bca138dde40ea9727f79d75b77a14~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12后台界面</p>
<p>登录界面底部有一个 Manage Databases 的链接，点击进入会可以看到当前可用的数据库，可对它们进行备份、复制和删除操作，当然还可以创建新的数据库。直接进入的地址为：<a target="_blank" rel="noopener" href="http://localhost:8069/web/database/manager">http://localhost:8069/web/database/manager</a></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6273a0a18ffc476192650511b834ffa6~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12登录页</p>
<blockquote>
<p><strong>小贴士：</strong> 数据库管理器可进行一些管理操作，默认激活且没有保护措施。虽然对于开发来说这样非常方便，但即便是在测试或开发环境，对有包含真实数据的数据库都存在安全风险。建议设置一个复杂的管理密码甚至最好是关闭这一功能（在配置文件中设置 list_db &#x3D; False）。</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ba7740a07f5d4a4197a7c5d1a54a5ff4~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12管理数据库页</p>
<p>现在我们已有经了 Odoo 实例和数据库，下一步就是开启开发者模式这个用于实现我们项目的工具。</p>
<h3 id="开启开发者模式"><a href="#开启开发者模式" class="headerlink" title="开启开发者模式"></a>开启开发者模式</h3><p>要实现我们的项目，这里需要用到开发者模式所提供的工具。开发者模式使用我们可以在用户界面中直接对 Odoo 应用进行自定义操作。这有利于我们快速修改和添加功能，可用于进行一些添加字段的小调整乃至像创建带有多个模型、视图和菜单项的应用这样的复杂自定义开发。</p>
<p>但这种直接在用户界面执行的自定义开发相对于在后续章节讲到的编程工具而言也有其局限性，如它无法添加或扩展默认的 ORM 方法（虽然有时自动化动作足以作为一个替代方案）。它也不易于集成到结构性开发流，包括版本控制、自动化测试、部署到多环境（质量测试、预发布和生产环境）。</p>
<p>本文我们主要使用开发者模式来介绍在 Odoo 框架中应用配置是如何组织的、如何在开发者模式下进行简单的自定义和快速列出所要实现方案的框架或原型。进入 Settings &gt; Dashboard, 即可在右侧下方看到Activate the developer mode链接，点击该链接即可开启开发者模式（Odoo 9.0版本及以前的版本，开发者模式在 User 菜单的 About 对话框窗口中进行开启）。</p>
<p>在该页面我们还会看到一个Activate the developer mode (with assets)的选项，这个用于不对静态文件进行压缩，通常用于调试前端代码，开启后浏览的速度也会略慢。为加快加载速度，客户端中的 JavaScript 和 CSS 文件通常会被压缩。但这也导致我们很难对前端代码进行调试，Activate the developer mode (with assets)选项会把这些静态文件按照独立文件、非压缩的方式进行加载。</p>
<p>我们也可以通过修改当前的 URL 来进入开发者模式，这样就无需进入 Settings 页面，仅需修改链接中的…&#x2F;web#…为…&#x2F;web?debug#…或…&#x2F;web?debug&#x3D;assets#…，比如修改http:&#x2F;&#x2F;&#x2F;localhost:8069&#x2F;web#home为<a target="_blank" rel="noopener" href="http://localhost_8069/web?debug#home">http://localhost_8069/web?debug#home</a>。虽然没有直接的链接来开启前端框架的开发者模式，但也可以通过在前端页面URL上添加?debug&#x3D;assets 来取消静态文件的压缩， 但需要注意在我们点到其它页面时这个标记可能就会消失。</p>
<blockquote>
<p><strong>小贴士：</strong> Firefox 和 Chrome均提供开启和取消开发者模式的插件，请在火狐或 Chrome 的应用商店中搜索 Odoo debug 进行安装</p>
</blockquote>
<p>开发者模式一经开启，在菜单中就会增加两个选项：</p>
<ol>
<li>开发者工具菜单，以调试图标的形式出现在右上角用户名和头像的左侧</li>
<li>Settings 中的 Technical 菜单项</li>
</ol>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cbfe3ec275ce42bbb5aeb22ed02237e1~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12开发者模式</p>
<p>开发者模式还会在表单字段上添加一个额外信息：将鼠标悬停在字段上方，就会显示一些相关技术信息。下一部分我们一起来学习相关的开发者模式功能。</p>
<h2 id="为已有模型添加字段"><a href="#为已有模型添加字段" class="headerlink" title="为已有模型添加字段"></a>为已有模型添加字段</h2><p>为已有表单添加字段是种常见的自定义操作，我们无需创建自定义模块即可在用户界面中进行实现。就我们 to-do 应用而言，需要可以选取一组用户对 to-do 项进行协作。我们可以通过在 partner 表单中添加标识来找到这些用户，那么接下来为 partner 模型添加一个Is Work Team?标记。</p>
<p>Partner 模型是 Odoo 内核自带的，无需安装任何应用即可使用，但这样在菜单中就无法查看到。一个简单的方法是安装 Contacts 应用。没安装的朋友可以点击 Apps 菜单搜索该应用并进行安装：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fdb1c3beb87c487a856198af4e5bc319~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12 Contacts 应用</p>
<p>安装完成后即可在顶级菜单中找到 Contacts 项。</p>
<h3 id="为模型添加字段"><a href="#为模型添加字段" class="headerlink" title="为模型添加字段"></a>为模型添加字段</h3><p>开启开发者模式后，我们可通过菜单Settings &gt; Technical &gt; Database Structure &gt; Models 来查看模型的定义。这时搜索 res.partner(未安装其它应用的情况下第一个即是)，对应的模型描述为 Contact。点击打开表单视图，这时就可以看到 partner 模型的各类信息，包含字段列表：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6d0dee4f647240d08cf9f1e3af3b6f2f~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12 Contact 模型</p>
<p>点击 Edit，然后在字段列表的最下端点击 Add a line，即会弹出窗口用于创建新字段，输入：</p>
<ul>
<li><strong>Field Name:</strong>  x_is_work_team</li>
<li><strong>Field Label:</strong>  Is Work Team?</li>
<li><strong>Field Type:</strong>  boolean</li>
</ul>
<p>字段名（Field Name）必须以 x_开头，这是在用户界面创建模型和字段强制要求的，通过插件模块的自定开发不受这一限制。只修改添加以上信息点击Save &amp; Close保存即可。 这个模型有80多个字段，我们需要通过右上角的向右箭头浏览到最后一页才能看到新创建的字段。这时再点击左上角的 Save 按钮进行最终的保存。</p>
<h3 id="为表单视图添加字段"><a href="#为表单视图添加字段" class="headerlink" title="为表单视图添加字段"></a>为表单视图添加字段</h3><p>我们已经为 partner 模型创建了新字段，但对用户仍不可见，要实现这点我们还在在相应的视图中进行添加操作。再回到前述的 res.partner模型详情页，点击 Views 标签，我们就可以年到模块的各个 view 定义。正所所见，每个视图都是一每次数据库记录，修改或不回视图记录即时生效，在下一次加载视图时即可见：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ab1ba676c4ed4cdb8d652db2c409880e~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12 Contacts 视图标签</p>
<p>视图列表中有一些需要注意的事项，我们看到有不同的视图类型，如表单视图(Form)、树状列表视图(Tree)、搜索视图(Search)和看板视图(Kanban)。搜索视图指的是右上解搜索框中的过滤选项。其它视图的数据展示方法也各不相同，基本的类型有列表视图和表单视图（用于查看详细信息）。</p>
<blockquote>
<p><strong>小贴士：</strong> 树状视图(Tree) 和 列表视图(List) 实为同一视图，实际上Odoo 中的为列表视图，树状视图的名称是由历史原因产生的 - 过去列表视图是以树状层级结构来进行展示的。</p>
</blockquote>
<p>可以看到同一视图类型存在多个定义，通过 View Type 进行排序可以更清晰地看出。每种视图类型（如表单视图）可以有一个或多个base视图定义（包含空的继承视图字段）。菜单项使用窗口动作可以指定要用到的base视图，如果没有定义，将使用排序值(Sequence)最低的，因而可将其视为默认视图。 点击视图，可以在表单中看到包含排序值在内的所有详情：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/348bee97365341859dbb003141569728~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12基视图详情</p>
<p>每个base视图都可以有多个扩展，称为继承视图。每个继承视图可以对base视图添加修改，如对已有表单添加字段。</p>
<blockquote>
<p><strong>小贴士：</strong> 继承视图自身也可以被其它视图继承，这时最处层继承所内层继承执行后作用于base视图。</p>
</blockquote>
<p>res.partner 模型会包含众多的视图定义，因为类似我们的应用很多应用都需要对其进行扩展。一个替代方法是进入我们需要扩展的某一具体视图，使用开发者工具菜单对其进行编辑。这也可用于了解某一视图在用户界面的某处被使用了。下面我们就来进行操作：</p>
<p>1.点击 Contacts 应用显示联系人名片列表，然后点击任意名片进入相应的表单视图</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7aed2a2bc9214c41bff230ddb9741577~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12联系人名片列表</p>
<p>2.在表单视图界面，点击开发者工具菜单（右上解调试图标）并选择编辑视图(Edit View:Form)，这时可以看到与前述模型页面相同的视图明细表单，但展示在实际定义使用base视图之上。也就是res.partner.form视图，通过External ID可以查看模块所有者。本处为base.view_partner_form，所以我们知道这个视图属于基模块。在Architecture字段中，我们可以看到base视图定义的 XML 代码。我们可以在这里编辑视图结构并添加我们的新字段，但从长期看这不 一个好办法：这个视图属于一个插件模块，一旦模块被更新，自定义的代码就会被覆盖并丢失。修改视图的正确姿势为创建一个继承视图(Inherited Views)扩展：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/222e26e8ebd7400189a3d08cd0244c3e~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>表单编辑继承视图</p>
<p>3.使用继承视图标签我们可以为 base 视图添加扩展视图：</p>
<p>I.首先我们需要在原始视图选择一个元素作为扩展点，我们可以通过查看 base视图的结构选择一个包含 name 属性的 XML 元素，大多数情况选择的是一个<field>元素，此外我们选择&lt;field name&#x3D;”category_id”…&gt;元素：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/464d4e5593f24c21b99e4969a7dea0cc~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12 表单视图 category_id 字段</p>
<p>II.现在，点击开发者工具菜单，然后点击 编辑视图(Edit View:Form)，选择继承视图标签(Inherited Views)标签回到前述的界面，然后点击最下方的 Add a line链接</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/24859bb082b34989b86cecd239535782~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12创建视图扩展</p>
<p>III.此时会弹出名为Create Views which inherit from this one的窗口，填入如下内容</p>
<ul>
<li>View Name: Contacts - Custom “Is Work Team” flag</li>
<li>Architecture:输入如下 XML代码</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;field name=&quot;category_id&quot; position=&quot;after&quot;&gt;</span><br><span class="line">  &lt;field name=&quot;x_is_work_team&quot; /&gt;</span><br><span class="line">&lt;/field&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>其它重要字段，如 Model, View Type 和 Inherited View 使用默认值即可</li>
</ul>
<p>IV.此时点击 Save &amp; Close按钮，然后在Edit View: Form 窗口点击kSave按钮</p>
<p>在保存修改后重载联系人表单视图页面即可查看到变化，在大数浏览器中可以使用 F5快捷键来重载页面。这时打开任意联系名片，可以看到右侧 Tags 字段下会多出一个新字段：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/92b0e2c1c4544dab8272e8dbc935a6d2~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12联系人表单视图</p>
<h2 id="创建新的模型-Model"><a href="#创建新的模型-Model" class="headerlink" title="创建新的模型(Model)"></a>创建新的模型(Model)</h2><p>模型是应用的基本组件，包含了所需使用到的数据结构和存储。接下来我们就为 To-do 项目添加模型，将包含三个字段：</p>
<ul>
<li>Description</li>
<li>Is done? 标记</li>
<li>Work team 用户列表</li>
</ul>
<p>如前所述，通过菜单Settings &gt; Technical &gt; Database Structure &gt; Models可进入模型创建页面，步骤如下：</p>
<p>1、进入模型菜单，点击左上角 Create 按钮，在弹出页面填入</p>
<ul>
<li>Model Description: To-do Item</li>
<li>Model: x_todo_item</li>
</ul>
<p>在进一步添加字段之前可以先进行保存。</p>
<p>2、点击 Save 保存然后点击 Edit 再次进入编辑，可以看到 Odoo 自动添加了一些字段，ORM在所有模型中添加了这些字段，可用于审计和记录功能。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a394fd08c8ed4be48cdeb6242fe2e468~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12 Todo Item</p>
<p>x_name (或Name)字段是在列表中显示记录或其它记录中引用时显示的标题。这 To-do Item标题中将使用它，还可以对其进行编辑将字段标签改为更能表达含义的描述。添加 Is Done? 标记此时就显得非常容易了。</p>
<p>3、在字段列表页底部点击 Add a line 链接创建一个包含如下值的字段：</p>
<ul>
<li><strong>Field Name:</strong>  x_is_done</li>
<li><strong>Field Label:</strong>  Is Done?</li>
<li><strong>Field Type:</strong>  boolean</li>
</ul>
<p>该字段的填写效果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/48a874a43f3a4b42b9360d0a326adb15~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12 To-do 应用x_is_done</p>
<p>接下来添加 Work Team 字段将更加有挑战性了，不仅因为这是一个指向 res.partner 对应记录的关联字段，它还是一个包含多个值的 selection 字段。在很多框架中这都会颇为复杂，但所幸我们使用的是 Odoo，因为它支持 many-to-many 关联。To-do 应用属于这一情况，因为一条任务可以有多个用户，同时一个用户也可以参与多条任务。</p>
<p>4、再次在字段列表中点击 Add a line，添加一个包含如下值的字段：</p>
<ul>
<li><strong>Field Name:</strong>  x_work_team_ids</li>
<li><strong>Field Label:</strong>  Work Team</li>
<li><strong>Field Type:</strong>  many2many</li>
<li><strong>Object Relation:</strong>  res.partner</li>
<li><strong>Domain:</strong>  [(‘x_is_work_team’, ‘&#x3D;’, True)]</li>
</ul>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/01fe7d67468446079f6b2dbda9c492f0~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12任务清单应用x_work_team_ids</p>
<p>many-to-many字段有定独有的定义项-Relation Table, Column 1, and Column 2项，这些值会被自动填充，大多数情况下都无需修改。在<em>第六章 模型 - 结构化应用数据</em>中将会有更详细的探讨。 Domain 项为非必填项，这里使用到是因为只有符合条件的用户才可被选取加入工作组，如果不加这项则所有用户均可被选取。</p>
<p>Domain 表达式中对展示的记录进行了过滤，它遵循Odoo 独有的语法-一个包含三个值的元组，第一项为过滤的字段名、第二项为过滤操作符、第三项为过滤作用的值。详细的解释参见<em>第七章 记录集 - 使用模型数据</em>。</p>
<blockquote>
<p>小贴士：Odoo有一个交互式的 domain 过滤向导可帮助生成 domain 表达式。访问Settings &gt; Technical &gt; User Interface &gt; User-defined Filters，点击 Create选择模型后将会出现 Add filter 按钮，可通过选择字段在下方的文本框中实时生成 domain 表达式。</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/858a6418c57b48b099bc2377a1753cca~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12 domain 过滤表达式生成器</p>
<p>现在我们已经为 To-d0应用创建好了模型，但还无法使用它，在创建模型后，我们需要配置组来使用该模型。</p>
<h2 id="配置安全权限控制"><a href="#配置安全权限控制" class="headerlink" title="配置安全权限控制"></a>配置安全权限控制</h2><p>Odoo自带有权限控制机制，用户仅能使用被授权了的功能。这就意味着我们自建的库功能不对普通用户甚至是管理员开放。</p>
<blockquote>
<p><strong>注意：Odoo 12的修改</strong> 管理员用户现在也像其它用户一样受权限控制所限制。而在此前的 Odoo 版本中，admin 都作为特殊用户不受权限规则控制。而新版中我们需要进行授权管理员才能访问模型数据</p>
</blockquote>
<p>Odoo 安全权限通过安全组来设置访问权限。每个用户的权限根据所属组来决定，对于我们的测试项目，我们将创建一个 to-do 用户组，分然后通过组来分配可使用功能的用户。我们通常使用 ACL 为某个组赋予指定模块的读或写权限，就当前项目，我们对添加的 to-do 项模型添加读和写权限。</p>
<p>此外，我们还可以设置用户对指定模型的记录范围的访问规则。本项目中 to-do 项为用户私有，所以用户仅能访问自己创建的记录，这通过安全记录规则实现。</p>
<h3 id="安全组"><a href="#安全组" class="headerlink" title="安全组"></a>安全组</h3><p>访问控制基于组，通过安全组对模型设置权限，控制组内用户所能使用的菜单项。要做更精细化的控制，我们可以对指定菜单项、视图、字段甚至是（带有记录规则的）数据记录进行权限控制。</p>
<p>安全组还可以对应用进行管理，通常每个应用有两个组：用户组(Users)可执行日常操作、管理员组(Manager)可对应用执行所有配置。</p>
<p>下面我们新建一个安全组，在菜单中访问Settings &gt; Users &amp; Companies &gt; Groups。点击 Create通过如下值创建一条新记录：</p>
<ul>
<li>Application: 留空</li>
<li>Name: To-do User</li>
<li>Inherited 标签下: 添加User types &#x2F; Internal User项</li>
</ul>
<p>效果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4778ec1750dd4270ad57b1ee8ae1e428~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12 To-do User安全组</p>
<p>在 Application 下拉列表中还没有to-do 应用，所以我们直接通过组表单进行添加。我们还继承了 Internal User 用户组，那么这个组的成员也会自动（递归）成为所继承组的成员，以获取他们原有的权限。Internal User 是基础权限组，通常应用的安全组都继承它。</p>
<blockquote>
<p><strong>注意：Odoo 12的修改</strong> 在 Odoo 12之前，内部用户组称作雇员(Employee)，这只是表面上的修改，代码中标识符(XML id)仍然和此前版本相同：base.group_user。</p>
</blockquote>
<h3 id="安全权限控制列表"><a href="#安全权限控制列表" class="headerlink" title="安全权限控制列表"></a>安全权限控制列表</h3><p>现在我们可以对指定组(To-do User)进行指定模型的权限授予，在上述表单的Access Rights标签下添加一条记录，对应的值为：</p>
<ul>
<li>Name: To-do Item User Access</li>
<li>Object: 在列表中选择To-do Item</li>
<li>勾选Read Access, Write Access, Create Access, and Delete Access</li>
</ul>
<p>模型权限也可通过Settings &gt; Technical &gt; Security &gt; Access Rights进行管理。我们无面向 Partner 模型添加权限，因为我们的组继承了内部用户组，已经获取了相应权限。</p>
<p>现在可以将 admin 用户添加到新建组来测试新加的权限设置</p>
<p>1、在菜单中点击Users &amp; Companies &gt; Users，从用户列表中选择Mitchell Admin，然后编辑表单</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/280140a78e4548a295cf84b11c76c3a0~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12 管理员权限编辑界面</p>
<p>2、在Access Rights标签下的 Other 版块，会发现一个名为 To-do User 的复选框用于让用户加入权限组，勾选后点击 Save 保存表单。</p>
<p>如果一切操作都正确的话，我们就可以看到 to-do 顶级菜单，用于添加 to-do 项，并且我们只能访问自己的任务清单而看不到其它人的。（请先执行<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c200d27f672e#menu-items">创建菜单项</a>部分再进行查看）</p>
<h3 id="安全记录规则"><a href="#安全记录规则" class="headerlink" title="安全记录规则"></a>安全记录规则</h3><p>在对模型赋予访问权限时，默认用户可以访问到它的所有记录。但有时我们要限制每个用户所能访问的特定记录。通过记录规则可以实现这一点，通过定义 domain 过滤器来对读和写操作进行控制。</p>
<p>比如我们这里的 to-do 就用，任务项应为用户私有，我们不希望其他用户看到自己的记录。需要添加记录规则来过滤出创建者自己的记录：</p>
<ul>
<li>框架会自动添加create_uid字段，并存储创建记录的用户，通过该字段可以确定每条记录的创建者</li>
<li>在user变量中可获取到当前用户，user 变量读取上下文中 domain 过滤器过滤后的对象</li>
</ul>
<p>通过[(‘create_uid’, ‘&#x3D;’, user.id)]域表达式可实现这点。通过菜单中的Settings &gt; Technical &gt; Security &gt; Record Rules 进入记录规则设置页，点击 Create 并输入如下值：</p>
<ul>
<li><strong>Name:</strong>  一个描述性的标题，这里使用 To-do Own Items</li>
<li><strong>Object:</strong>  在列表中选择模型，此处为To-do Item</li>
<li><strong>Access Rights:</strong>  规则所授予的操作，这里保留全部勾选</li>
<li><strong>Rule Definition:</strong>  域过滤器，填写 [(‘create_uid’, ‘&#x3D;’, user.id)]</li>
<li><strong>Groups:</strong>  作用的安全组，选择To-do User组</li>
</ul>
<p>效果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b97ca07937374b218591241c2b72798d~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12记录规则</p>
<p>此时就完成了记录规则的设定，现在可以试试用 Admin 和 Demo 用户分别创建几个任务项，各自将只能看到自己创建的任务。记录规则可通过右上角的切换按钮进行关闭，一旦关闭，就可以看到所有用户的任务清单了。</p>
<h3 id="超级用户账号"><a href="#超级用户账号" class="headerlink" title="超级用户账号"></a>超级用户账号</h3><p>在此前的 Odoo 版本中，admin 用户是一个特权用户可以不受权限控制。Odoo 12就些做了调整，admin 用户属于所有用户安全组，但只是个普通用户。还是存在一个超级用户不受权限控制，但它无法进行登录。</p>
<p>我们还是可以以超级用户进行操作，当一个用户以 Administration &#x2F; Settings 用户组登录时，开发者工具菜单中有一个 Become Superuser选项，或者在登录页面开启开发者模式，则会出一个Login as superuser的隐藏按钮。</p>
<p>在激活了超级用户后，右上角的当前用户显示为 OdooBot，该处背景也会变成黄黑间隔的条状，以清楚的告知用户激活了超级用户。仅在绝对必要时才应使用这一操作，超级用户不受权限控制这点会导致数据的不一致，比如在多公司场景下，所以应尽量避免。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ddd839f82e9f4923a7a65ce0c4c0115c~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12激活超级用户</p>
<h2 id="创建菜单项"><a href="#创建菜单项" class="headerlink" title="创建菜单项"></a>创建菜单项</h2><p>现在有了存储任务清单的模型，应在用户界面中显示它，添加菜单项可实现这一点。我们这里创建一个顶级菜单项直接打开任务清单，一些像联系人(Contacts)这样的应用采取了这种方式，但另外一些则使用了在顶栏中的子菜单项。</p>
<blockquote>
<p><strong>注意：Odoo 12的修改</strong> 社区版中第一级以下的菜单项也像企业版中一样显示在了顶栏中，而此前版本社区版的菜单项显示在屏幕的左侧。</p>
</blockquote>
<p>点击菜单Settings &gt; Technical &gt; User Interface &gt; Menu Items，点击 Create 即可进入菜单的编辑页面。在该页面中输入如下值：</p>
<ol>
<li><p><strong>Menu:</strong>  To-do</p>
</li>
<li><p><strong>Parent Menu:</strong>  留空</p>
</li>
<li><p><strong>Action:</strong>  选择ir.actions.act_window，然后在右侧下拉框中点击Create and Edit打开一个相关的窗口操作表单</p>
</li>
<li><p>在弹出的表单中填入</p>
<ul>
<li><p><strong>Action name:</strong>  To-do Items</p>
</li>
<li><p><strong>Object:</strong>  x_todo_item (目标模型的编码标识)</p>
</li>
<li><p>显示效果如下</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c64c0068c1f144ee9e3a237263e03ef9~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12窗口操作表单</p>
</li>
</ul>
</li>
<li><p>保存所有打开的表单，此时即可在菜单中使用 To-do 应用了</p>
</li>
</ol>
<p>要在菜单中显示该项，需要重载客户端页面，大多数浏览中可使用快捷键 F5（强制刷新：Windows: Ctrl+F5, Mac: Cmd+F5）。现在就可以访问菜单项并进行任务清单模型的交互了。虽然我们没有创建视图，但强大的 Odoo 框架自动为我们生成了一个基础视图：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/585127473b4c479ab3cabf0e0fa7d5d9~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12任务清单基础视图</p>
<p>在本例中，在顶级菜单中直接添加了一个操作，而没有子菜单。但菜单可以包含一系列带有父子关系的菜单项，最末级菜单项关联一个操作(Action)，定义有选取时执行的行为。 操作名将作为所展示视图的标题。</p>
<p>有很多的操作类型，最重要的有窗口(window)、报表(reports)和服务端(server)操作。窗口操作最常用，用作在客户端中展示视图，报表操作用于运行报表，服务端操作用于定义自动化任务。</p>
<p>截至目前，我们都聚焦在显示视图的窗口操作上，正是使用了直接在菜单项表单中创建的窗口操作来创建了任务清单的菜单项。我们也可以在Settings &gt; Technical &gt; Actions中查看和编辑操作，在本例中仅需使用窗口操作。</p>
<blockquote>
<p><strong>小贴士：</strong> 很多情况下使用开发者工具中的 Edit Action 选项更为方便，它提供一个编辑当前视图窗口操作的快捷方式。</p>
</blockquote>
<p>接下来我们进入到下一部分，创建我们的视图。</p>
<h2 id="创建视图"><a href="#创建视图" class="headerlink" title="创建视图"></a>创建视图</h2><p>前面我们创建了一个任务清单模型通过菜单项在用户界面中显示，接下来我们为它创建两个基本视图：列表视图和表单视图。</p>
<h3 id="列表视图"><a href="#列表视图" class="headerlink" title="列表视图"></a>列表视图</h3><p>创建列表视图步骤如下：</p>
<p>1、点击Settings &gt; Technical &gt; User Interface &gt; Views，点击 Create 进入视图编辑页面，填入如下值：</p>
<ul>
<li><strong>View Name:</strong>  To-do List View</li>
<li><strong>View Type:</strong>  Tree</li>
<li><strong>Model:</strong>  x_todo_item</li>
</ul>
<p>效果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9de170c47f894d1696bce7f721afc41e~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12为任务清单创建列表视图</p>
<p>2、在Architecture标签下，使用 XML 书写视图的结构，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;tree&gt;</span><br><span class="line">  &lt;field name=&quot;x_name&quot; /&gt;</span><br><span class="line">  &lt;field name=&quot;x_is_done&quot; /&gt;</span><br><span class="line">&lt;/tree&gt;</span><br></pre></td></tr></table></figure>

<p>列表视图的基本结构非常简单：一个包含列表视图中显示的一个或多个列元素的元素(element)。在列表视图还有一些有意思的选项，将在<em>第十章 后台视图 - 设计用户界面</em>中详细探讨。</p>
<h3 id="表单视图"><a href="#表单视图" class="headerlink" title="表单视图"></a>表单视图</h3><p>创建表单视图的步骤如下：</p>
<p>1、创建另一条视图记录，并填入如下值：</p>
<ul>
<li>View Name: To-do Form View</li>
<li>View Type: Form</li>
<li>Model: x_todo_item</li>
</ul>
<blockquote>
<p><strong>小贴士：</strong> 如果不指定 View Type,将会通过视图定义代码来自动识别。</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a94cf748de1348beb9990549ba6a91c9~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12任务清单创建表单视图</p>
<p>2、在Architecture标签下, 输入如下XML 代码:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;form&gt;</span><br><span class="line">  &lt;group&gt;</span><br><span class="line">    &lt;field name=&quot;x_name&quot; /&gt;</span><br><span class="line">    &lt;field name=&quot;x_is_done&quot; /&gt;</span><br><span class="line">    &lt;field name=&quot;x_work_team_ids&quot; </span><br><span class="line">          widget=&quot;many2many_tags&quot;</span><br><span class="line">          context=&quot;&#123;&#x27;default_x_is_work_team&#x27;: True&#125;&quot; /&gt;</span><br><span class="line">  &lt;/group&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p>表单视图结构根节点有一个<form>元素，包含<field>元素，其它相关元素将在<em>第十章 后台视图 - 设计用户界面</em>中进行学习。这里还有一个针对工具组字段的小组件(widget)，以标签按钮而非列表栏显示。这一个按钮状标签通过在工作组字段中添加 widget 属性来实现。</p>
<p>默认情况下，关联字段允许直接创建记录用作关联。也就说可以在工作组字段中直接创建用户，但如果这么做用户将不会带有Is Work Team? 标记，也就产生了不一致性。</p>
<form>

<p>为了更好的用户体验，在这种情况下我们可以默认就带有这一标记。这需要通过 context 属性来实现，它向下一个视图传递 session 信息，比如要使用的默认值。在后续章节中会就此进行探讨，现在只要知道这是一个键值对的字典即可。以 default_作为前缀来提供对应字段的默认值。</p>
<p>所以此处要为用户设置Is Work Team? 标记所需的表达式为{‘default_x_is_work_team’: True}。</p>
<p>此时点击 To-do菜单进行创建或打开已有清单则会显示为我们所创建的视图。</p>
</form>

<h3 id="搜索视图"><a href="#搜索视图" class="headerlink" title="搜索视图"></a>搜索视图</h3><p>我们可以为列表视图右上角的搜索框预设一些过滤项和分组选项，Odoo 把这些也视图元素，所以可以像列表视图和表单视图一样在 Views 中添加记录来定义。想必现在大家已经非常熟悉了，在菜单中点击Settings &gt; Technical &gt; User Interface &gt; Views 或在开发者工具中对应上下文中进行编辑操作均可。我们进入任务清单列表视图，点击开发者工具中的Edit Search View。</p>
<p>当前列表清单模型还未定义过任何搜索视图，所以显示一个空表单用于进行创建，填入如下值并保存：</p>
<ol>
<li><strong>View Name:</strong> 选择一个有意义的描述，此处使用To-do Items Filter</li>
<li><strong>View Type:</strong>  Search</li>
<li><strong>Model:</strong>  x_todo_item</li>
<li><strong>Architecture:</strong>  添加如下XML 代码:</li>
</ol>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c4bf577dbe1f47429509952d153bb8e4~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12任务清单搜索视图</p>
<p>此时重载任务清单，可以在搜索框下方 Filters 按钮下选择预设的 Not Done 过滤器，在搜索框中输入 Not Done也会提示过滤条件。默认开启过滤器会较便捷，在不需时取消过滤即可。正如默认字段值一样，还是使用 context 属性来设置默认过滤器。</p>
<p>在点击 To-do 菜单时，执行一个窗口操作打开列表视图，该操作可设置一个上下文值，让视图默认开启某一搜索过滤器，操作步骤如下：</p>
<ol>
<li>点击To-do 菜单进入任务清单列表</li>
<li>点击开发者工具图标并选择Edit Action，这时将弹出一个窗口操作界面，在右下角有一个 Filters版块，这里有 Domain 和 Context 字段。</li>
</ol>
<p>Domain 字段可用于为所显示记录设置固定的过滤器，而且用户无法删除。这不符合我们的场景。我们只是要默认开启item_not_done过滤器，用户可以随时取消选择。默认打开过滤器，添加以search_default_作为前缀的 context 键，这里使用{‘search_default_item_not_done’: True}</p>
<p>这时再点击 To-do 菜单，搜索框中默认就会开启 Not Done 过滤器。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/35d45316a7cf44d8a0777f038196484b~tplv-k3u1fbpfcp-zoom-1.image"></p>
<p>Odoo 12任务清单默认过滤器</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在本文中，我们不仅概览了 Odoo 组件的组织方式，还利用开发者模式深入到 Odoo 内部来理解这些组件如何共同协作创建应用。</p>
<p>我们还使用这些工具创建了一个简易的应用，包含模型、视图和对应的菜单。并且掌握了通过开发者工具可以查看当前应用或在用户界面中直接进行快速自定义操作。</p>
<p>下一篇中我们将更深入地了解 Odoo 开发，并学习如何设置和组织开发环境。</p>
<p>本文首发地址：<a target="_blank" rel="noopener" href="https://alanhou.org/developer-mode-odoo12/">Alan Hou 的个人博客</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Alan Hou</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
